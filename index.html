<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NPA Image Lab ‚Äî AI Prompt & Caption Builder (Dummy)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071026; --card:#0f1724; --card-2:#0b2236; --glass: rgba(255,255,255,0.04);
    --muted:#9fb3c8; --accent:#00f5c4; --accent-2:#28a7ff; --white:#f7fbff;
    --pill:#0c2b45;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:
    linear-gradient(180deg,#041026 0%, #061528 60%); color:var(--white); -webkit-font-smoothing:antialiased}
  .wrap{max-width:820px;margin:20px auto;padding:20px}
  h1{margin:0 0 8px;font-size:28px;line-height:1.05}
  p.lead{color:var(--muted);margin:0 0 14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
        border:1px solid rgba(255,255,255,0.03); border-radius:14px;padding:18px;margin:14px 0; box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  select,input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1;min-width:140px}
  .btn{display:inline-flex;gap:8px;align-items:center;justify-content:center;padding:12px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#012;
             box-shadow:0 6px 18px rgba(40,167,255,0.12)}
  .btn-white{background:#ffffff10;color:var(--white);border:1px solid rgba(255,255,255,0.06)}
  .btn-yellow{background:#ffcf4b;color:#082; font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  .preview{height:360px;border-radius:12px;overflow:hidden;background:#071026;display:flex;align-items:center;justify-content:center;position:relative}
  .preview img{max-width:100%;max-height:100%;object-fit:cover;display:block}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .small{font-size:13px;padding:8px 10px;border-radius:8px}
  .badge{background:#081828;padding:6px 10px;border-radius:999px;color:var(--muted);font-weight:600}
  footer{color:var(--muted);font-size:13px;margin-top:12px;text-align:center}
  .toast{position:fixed;right:20px;bottom:20px;background:#0b2b3a;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);color:var(--white)}
  .switch{display:inline-flex;align-items:center;gap:8px}
  .mode-toggle{background:linear-gradient(180deg,#ffffff10,#ffffff05);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  textarea{min-height:110px;resize:vertical}
  .caption-box{background:linear-gradient(180deg,#021427,#031b2b);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
  .hint{font-size:12px;color:#9fb3c8;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
    <div>
      <h1>NPA Image Lab ‚Äî Prompt & Caption Builder</h1>
      <p class="lead">Default: <strong>4:5 (Feed)</strong>. Generator dummy (Unsplash) ‚Äî tanpa API key. Mode: <span id="modeLabel">Dark</span></p>
    </div>
    <div class="mode-toggle" title="Toggle mode">
      <button id="toggleMode" class="badge">Toggle Mode</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;gap:14px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px">
        <label>Pilih Ide Gambar (Auto prompt)</label>
        <select id="themeSelect">
          <option value="3ireborn modern finance">3IReborn ‚Äî Perlindungan & Investasi</option>
          <option value="nganggur lifestyle relaxed">Nganggur Aja ‚Äî Lifestyle santai</option>
          <option value="business syariah modern">Bisnis Syariah Modern</option>
          <option value="motivational community uplift">Komunitas & Networking</option>
          <option value="success coaching mentor">Personal Coaching & Mentor</option>
          <option value="family wellbeing calm">Keluarga & Kesejahteraan</option>
          <option value="small business storefront">Warung / UMKM yang menggugah selera</option>
          <option value="islamic spiritual serenity">Inspirasi Islami ‚Äî Tenang & Syariah</option>
          <option value="minimalist corporate clean">Clean Corporate ‚Äî Minimalis</option>
          <option value="celebration achievement trophy">Celebration ‚Äî Sukses & Pencapaian</option>
          <option value="custom">‚Äî Custom (ketik di bawah) ‚Äî</option>
        </select>

        <label style="margin-top:10px">Custom Ide (opsional)</label>
        <input id="customIdea" placeholder="Tuliskan ide / kata kunci khusus (jika pilih Custom)" />

        <div style="display:flex;gap:10px;margin-top:10px">
          <div class="col">
            <label>Gaya Visual</label>
            <select id="visual">
              <option>Elegant Minimalist</option>
              <option>Clean Corporate</option>
              <option>Warm Homely</option>
              <option>Clean Islamic</option>
              <option>Bold Colorful</option>
              <option>Photography Realistic</option>
            </select>
          </div>
          <div class="col">
            <label>Gaya Caption</label>
            <select id="tone">
              <option>Inspiratif</option>
              <option>Persuasif</option>
              <option>Motivasi Lembut</option>
              <option>Serius & Profesional</option>
              <option>Humoris & Santai</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px" class="controls">
          <div>
            <label>Rasio Gambar</label>
            <select id="ratio">
              <option value="4:5">4:5 ‚Äî Feed (DEFAULT)</option>
              <option value="1:1">1:1 ‚Äî Square</option>
              <option value="9:16">9:16 ‚Äî Story/Reels</option>
            </select>
          </div>
          <div>
            <label>Jumlah Gambar (dummy)</label>
            <select id="count">
              <option>1</option>
              <option>2</option>
              <option>3</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px" class="row">
          <button id="genBtn" class="btn btn-primary">üöÄ Generate Gambar</button>
          <button id="copyCaption" class="btn btn-white">üìã Copy Caption</button>
          <button id="refreshCaption" class="btn btn-yellow">üîÑ Refresh Caption</button>
        </div>

        <div style="margin-top:12px" class="row">
          <button id="sendNpa" class="btn" style="background:#13a89e;color:#021">üì° Kirim ke NPA Smart</button>
          <button id="downloadAll" class="btn btn-white">‚¨áÔ∏è Download Gambar + Caption</button>
        </div>

        <p class="hint">Catatan: generator gambar pakai Unsplash Source (gratis) untuk preview. Ketika kamu mau pakai model AI berbayar, ganti integrasi backend.</p>
      </div>

      <div style="flex:1;min-width:300px">
        <label>Preview Gambar</label>
        <div class="preview card" id="preview">
          <div style="text-align:center;color:var(--muted)">
            <div style="font-size:14px">Belum ada gambar</div>
            <div style="font-size:12px;margin-top:6px">Klik "Generate Gambar"</div>
          </div>
        </div>

        <div style="margin-top:12px" class="card">
          <label>Caption (aman untuk FB-Pro ‚Äî <em>tidak</em> menyertakan link)</label>
          <div id="caption" class="caption-box">Caption akan muncul setelah generate</div>
          <textarea id="captionHidden" style="display:none"></textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="card" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
    <div class="badge">Tips</div>
    <div class="muted">Gunakan caption tanpa link ‚Äî taruh referral link di kolom komentar saat posting di FB Pro. Tombol "Kirim ke NPA Smart" hanya simulasi (tampilkan payload).</div>
  </div>

  <footer>Made for Nganggur Preneur Akademi ‚Ä¢ Dummy mode (no API keys)</footer>
</div>

<div id="toast" class="toast" style="display:none"></div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const toast = $('toast');
  function showToast(msg, t=2500){
    toast.textContent = msg; toast.style.display='block';
    setTimeout(()=>toast.style.display='none', t);
  }

  // map ratio to size
  function sizeForRatio(r){
    if(r==='4:5') return {w:1080,h:1350};
    if(r==='1:1') return {w:1080,h:1080};
    if(r==='9:16') return {w:1080,h:1920};
    return {w:1080,h:1350};
  }

  // build prompt from UI
  function buildPrompt(){
    const sel = $('themeSelect').value;
    const custom = $('customIdea').value.trim();
    const base = sel === 'custom' && custom ? custom : sel;
    const visual = $('visual').value;
    return `${base}, ${visual}, high quality poster, bright composition, centered subject, soft lighting, realistic, people smiling (if relevant)`;
  }

  // caption generator (simple local rules - FB-Pro safe)
  function generateCaption(prompt, tone){
    // create a few template variants
    const templates = {
      'Inspiratif': [
        `Banyak yang kaget setelah tahu hal sederhana ini. ${prompt.split(',')[0]}. Pelan tapi pasti ‚Äî langkah kecil hari ini bisa berubah jadi besar esok.`,
        `Mulai hari ini dengan niat yang jelas. ${prompt.split(',')[0]} ‚Äî yakin dan berproses. Yuk bagikan kalau bermanfaat!`
      ],
      'Persuasif': [
        `Ingin hidup lebih aman dan terencana? ${prompt.split(',')[0]} adalah langkah kecil yang bisa kamu mulai hari ini. Coba tanya aku caranya.`,
        `Jangan tunggu sempurna. Mulai sekarang: fokus pada perlindungan dan pertumbuhan. Ada yang mau tanya?`
      ],
      'Motivasi Lembut': [
        `Santai saja, tapi konsisten. ${prompt.split(',')[0]} ‚Äî tetap semangat dan percaya proses.`,
        `Pelan tapi pasti. Lakukan satu tindakan kecil hari ini untuk masa depan yang lebih tenang.`
      ],
      'Serius & Profesional': [
        `Solusi praktis untuk perlindungan dan investasi jangka panjang. ${prompt.split(',')[0]}. Hubungi untuk info terperinci.`,
        `Pendekatan profesional dan efisien‚Äîkita bantu rencanakan langkah Anda ke depan.`
      ],
      'Humoris & Santai': [
        `Ngopi dulu, lalu bergerak. ${prompt.split(',')[0]} ‚Äî solusi santai untuk hidup lebih #tenang.`,
        `Biar nggak cuma nganggur doang: langkah kecil hari ini, hasil besar nanti. Siapa mau ikut?`
      ]
    };

    const list = templates[tone] || templates['Inspiratif'];
    // pick randomly
    const c = list[Math.floor(Math.random()*list.length)];
    // ensure no links included
    return c;
  }

  // generate Unsplash URL for dummy image
  function makeImageURL(prompt, ratio){
    const s = sizeForRatio(ratio);
    // unsplash source with query
    const q = encodeURIComponent(prompt.replace(/\s+/g,' '));
    // using source.unsplash to avoid api key
    return `https://source.unsplash.com/${s.w}x${s.h}/?${q}`;
  }

  // state
  let lastImageURL = '';
  let lastPrompt = '';

  // generate action
  $('genBtn').addEventListener('click', async ()=>{
    const prompt = buildPrompt();
    const ratio = $('ratio').value;
    const tone = $('tone').value;
    lastPrompt = prompt;
    const url = makeImageURL(prompt, ratio);
    lastImageURL = url;
    // show loading
    const preview = $('preview');
    preview.innerHTML = '<div style="color:var(--muted)">Sedang mengambil gambar dari Unsplash‚Ä¶</div>';
    try{
      // load image with crossOrigin to allow canvas draw
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function(){
        preview.innerHTML = '';
        img.style.width='100%';
        img.style.height='100%';
        img.style.objectFit='cover';
        preview.appendChild(img);
        // generate caption
        const cap = generateCaption(prompt, tone);
        $('caption').textContent = cap;
        $('captionHidden').value = cap;
        showToast('Gambar & caption siap ‚úÖ');
      };
      img.onerror = function(){
        preview.innerHTML = '<div style="color:var(--muted)">Gagal ambil gambar ‚Äî coba lagi</div>';
        showToast('Gagal ambil gambar (CORS/ jaringan).', 3000);
      };
      img.src = url + '&sig=' + Math.random().toString(36).slice(2,8); // sig untuk variasi cache
    }catch(e){
      preview.innerHTML = '<div style="color:var(--muted)">Error saat generate</div>';
      console.error(e);
      showToast('Error saat generate',3000);
    }
  });

  // copy caption
  $('copyCaption').addEventListener('click', async ()=>{
    const text = $('captionHidden').value || $('caption').textContent;
    if(!text || text.trim().length<3){ showToast('Belum ada caption untuk disalin'); return; }
    try{
      await navigator.clipboard.writeText(text);
      showToast('Caption disalin ke clipboard ‚úÖ');
    }catch(e){
      showToast('Tidak bisa akses clipboard ‚Äî copy manual',2500);
    }
  });

  // refresh caption
  $('refreshCaption').addEventListener('click', ()=>{
    if(!lastPrompt){ showToast('Generate gambar dulu ya'); return; }
    const tone = $('tone').value;
    const cap = generateCaption(lastPrompt, tone);
    $('caption').textContent = cap;
    $('captionHidden').value = cap;
    showToast('Caption diperbarui ‚úÖ');
  });

  // send to NPA Smart (simulasi)
  $('sendNpa').addEventListener('click', ()=>{
    if(!lastPrompt || !lastImageURL){ showToast('Generate gambar dulu'); return; }
    const payload = {
      image: lastImageURL,
      caption: $('captionHidden').value || $('caption').textContent,
      theme: $('themeSelect').value,
      visual: $('visual').value,
      ratio: $('ratio').value,
      ts: new Date().toISOString()
    };
    // simulate send ‚Äî show modal/payload
    alert('Simulasi kirim ke NPA Smart:\n\n' + JSON.stringify(payload,null,2) + '\n\n(Implementasikan endpoint FonNTE di backend untuk kirim real)');
  });

  // download image + caption -> create canvas composition and download PNG
  $('downloadAll').addEventListener('click', async ()=>{
    if(!lastImageURL){ showToast('Generate gambar dulu'); return; }
    showToast('Mempersiapkan download‚Ä¶', 2000);
    try{
      const ratio = $('ratio').value;
      const s = sizeForRatio(ratio);
      // load image blob (CORS)
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.src = lastImageURL + '&sig=' + Math.random().toString(36).slice(2,6);
      img.onload = ()=>{
        // create canvas with extra space for caption
        const captionText = $('captionHidden').value || $('caption').textContent;
        const padding = Math.round(s.h * 0.12);
        const canvas = document.createElement('canvas');
        canvas.width = s.w;
        canvas.height = s.h + padding;
        const ctx = canvas.getContext('2d');
        // draw image
        ctx.drawImage(img,0,0,s.w,s.h);
        // gradient overlay for caption area
        const grad = ctx.createLinearGradient(0,s.h,0,s.h+padding);
        grad.addColorStop(0,'rgba(0,0,0,0.0)');
        grad.addColorStop(1,'rgba(0,0,0,0.5)');
        ctx.fillStyle = grad;
        ctx.fillRect(0,s.h,s.w,padding);
        // caption text
        ctx.fillStyle = '#fff'; ctx.textAlign='left';
        const fontSize = Math.round(padding*0.32);
        ctx.font = `bold ${fontSize}px Poppins, sans-serif`;
        // wrap text
        const maxW = s.w - 40;
        const lines = wrapText(ctx, captionText, maxW);
        let y = s.h + 20 + fontSize/2;
        for(let i=0;i<Math.min(lines.length,3);i++){
          ctx.fillText(lines[i],20,y);
          y += fontSize + 6;
        }
        // filename
        const fname = 'npa-' + Date.now() + '.png';
        canvas.toBlob(function(blob){
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = fname;
          document.body.appendChild(a);
          a.click();
          a.remove();
          showToast('Gambar + caption didownload ‚úÖ',2500);
        }, 'image/png');
      };
      img.onerror = ()=>{
        showToast('Gagal ambil gambar untuk di-download (CORS).',3000);
      };
    }catch(e){
      console.error(e);
      showToast('Gagal membuat file',3000);
    }
  });

  // simple word wrap
  function wrapText(ctx, text, maxWidth){
    const words = text.split(' ');
    const lines = [];
    let line = '';
    for(let n=0;n<words.length;n++){
      const testLine = line + words[n] + ' ';
      const metrics = ctx.measureText(testLine);
      const testWidth = metrics.width;
      if(testWidth > maxWidth && n>0){
        lines.push(line.trim());
        line = words[n] + ' ';
      }else{
        line = testLine;
      }
    }
    lines.push(line.trim());
    return lines;
  }

  // mode toggle (just cosmetic)
  $('toggleMode').addEventListener('click', ()=>{
    const root = document.documentElement;
    if(root.style.getPropertyValue('--bg')==='#071026'){
      // switch to light-ish
      root.style.setProperty('--bg','#f6f9ff');
      root.style.setProperty('--card','#ffffff');
      root.style.setProperty('--card-2','#fbfdff');
      root.style.setProperty('--muted','#516783');
      root.style.setProperty('--accent','#2563eb');
      root.style.setProperty('--accent-2','#1e40af');
      document.body.style.background = 'linear-gradient(180deg,#f6f9ff,#eef6ff)';
      $('modeLabel').textContent='Light';
    }else{
      root.style.setProperty('--bg','#071026');
      root.style.setProperty('--card','#0f1724');
      root.style.setProperty('--card-2','#0b2236');
      root.style.setProperty('--muted','#9fb3c8');
      root.style.setProperty('--accent','#00f5c4');
      root.style.setProperty('--accent-2','#28a7ff');
      document.body.style.background = 'linear-gradient(180deg,#041026,#061528)';
      $('modeLabel').textContent='Dark';
    }
    showToast('Mode diganti');
  });

  // small UX: when theme custom selected, focus custom input
  $('themeSelect').addEventListener('change', (e)=>{
    if(e.target.value==='custom'){ $('customIdea').focus(); }
  });

  // initial: set default ratio 4:5
  $('ratio').value='4:5';

  // quick test: prefill captionHidden
  $('captionHidden').value='';

})();
</script>
</body>
          </html>
